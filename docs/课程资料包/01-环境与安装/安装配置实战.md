# Claude Code 安装配置实战 - 从零到运行完全指南

**课程模块**：模块1 - 环境与安装篇
**课程编号**：第2课（共2课）
**预计学时**：3-4小时
**难度等级**：⭐⭐ 入门级（零基础友好）
**字数**：约10,000字

---

## 📚 本课学习目标

通过本课学习,你将能够:

1. ✅ 掌握Claude Code三种安装方式的选择和实施
2. ✅ 完成首次启动和全套初始化配置
3. ✅ 理解并正确配置认证机制(API Key/订阅登录)
4. ✅ 成功集成到VS Code/Cursor等主流IDE
5. ✅ 完成完整的Hello World测试验证
6. ✅ 排查和解决常见安装配置错误
7. ✅ 配置跨平台开发环境(Windows/Mac/Linux)

---

## 课前准备检查清单

在开始安装前,请确认以下内容已完成(来自第1课):

| 检查项 | 状态 | 如果未完成 |
|-------|------|----------|
| Node.js v18+ | [ ] 已安装 | 返回第1课第一部分 |
| npm 9.0+ | [ ] 已安装 | 随Node.js一起安装 |
| ANTHROPIC_API_KEY | [ ] 已配置 | 返回第1课第三部分 |
| 网络连通性 | [ ] 可访问api.anthropic.com | 返回第1课第四部分配置代理 |
| 磁盘空间 | [ ] 至少3GB可用 | 清理磁盘空间 |

**如果所有项都已完成,让我们开始吧!**

---

## 第一部分: Claude Code安装方式详解(3,000字)

### 1.1 三种安装方式深度对比

Claude Code提供三种主要安装方式,每种方式都有其适用场景和特点:

#### 方式对比表

| 对比维度 | npm全局安装 | yarn/pnpm全局安装 | npx临时运行 |
|---------|------------|----------------|------------|
| **安装速度** | 中等(30-60秒) | 快(yarn)/很快(pnpm) | 慢(每次都下载) |
| **磁盘占用** | ~100MB | ~100MB | 临时缓存 |
| **依赖管理** | npm | yarn/pnpm | npm |
| **更新方式** | npm update -g | yarn/pnpm global upgrade | 自动最新 |
| **卸载清理** | npm uninstall -g | yarn/pnpm global remove | 无需卸载 |
| **适合新手** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **企业环境** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **CI/CD** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

#### 详细场景推荐

**场景1: 个人学习开发 → npm全局安装**
```
优势:
- 安装简单,一条命令搞定
- 社区资源最丰富
- 文档和教程最多
- 故障排查容易

劣势:
- 速度比pnpm慢
- 磁盘占用略高
```

**场景2: 企业团队开发 → yarn/pnpm全局安装**
```
优势:
- yarn: Workspaces支持,monorepo友好
- pnpm: 极致节省磁盘,符号链接机制
- 依赖锁定更可靠
- 性能更优

劣势:
- 需要额外安装yarn/pnpm
- 团队需要统一包管理器
```

**场景3: 临时试用/CI环境 → npx临时运行**
```
优势:
- 不污染系统
- 总是最新版本
- CI/CD管道友好
- 无需维护

劣势:
- 首次启动慢
- 网络依赖强
- 无法离线使用
```

---

### 1.2 方式1: npm全局安装详解(推荐新手)

这是最常用、最稳定的安装方式,适合90%的用户。

#### Windows系统安装步骤(含截图位置)

**步骤1: 打开管理员命令提示符**

1. 按下 `Win` 键(Windows图标键)
2. 输入 `cmd` (不要按回车)
3. 在搜索结果中,找到"命令提示符"
4. **右键**点击"命令提示符"
5. 选择"以管理员身份运行"
6. 看到用户账户控制提示,点击"是"

**截图位置提示**:
```
┌─────────────────────────────┐
│ 搜索框: cmd                  │
├─────────────────────────────┤
│ 最佳匹配                     │
│ 📁 命令提示符               │ ← 右键这里
│   → 以管理员身份运行        │ ← 点击这个选项
│   → 打开文件位置            │
│   → 固定到任务栏            │
└─────────────────────────────┘
```

**验证管理员权限**:
```cmd
# 命令提示符窗口标题栏应该显示"管理员: 命令提示符"
# 或者输入命令验证:
whoami /groups | find "High Mandatory Level"
# 如果有输出,说明是管理员权限
```

**为什么必须管理员权限?**
```
npm全局安装会写入以下目录:
C:\Users\<你的用户名>\AppData\Roaming\npm\
C:\Program Files\nodejs\

普通用户权限无法写入Program Files目录
会报错: EACCES: permission denied
```

**步骤2: 配置npm镜像源(中国大陆用户强烈推荐)**

在安装前,建议先配置国内镜像源,否则可能遇到超时:

```cmd
# 查看当前镜像源
npm config get registry

# 临时使用淘宝镜像(仅本次安装)
npm install -g @anthropic-ai/claude-code --registry=https://registry.npmmirror.com

# 永久切换到淘宝镜像(推荐)
npm config set registry https://registry.npmmirror.com

# 验证镜像源已切换
npm config get registry
# 应该输出: https://registry.npmmirror.com
```

**镜像源对比**:
| 镜像源 | 地址 | 速度(中国) | 同步延迟 |
|-------|------|-----------|---------|
| npm官方 | https://registry.npmjs.org | 慢/超时 | 实时 |
| 淘宝镜像 | https://registry.npmmirror.com | 快 | 10分钟 |
| 腾讯云 | https://mirrors.cloud.tencent.com/npm/ | 快 | 1小时 |

**步骤3: 执行安装命令**

```cmd
npm install -g @anthropic-ai/claude-code
```

**命令拆解说明**:
```
npm install      ← npm的安装子命令
-g               ← global(全局),让claude命令在任何目录都能用
@anthropic-ai/   ← npm组织作用域,表示这是Anthropic公司的包
claude-code      ← 包名
```

**安装过程输出详解**:

```cmd
C:\Windows\system32>npm install -g @anthropic-ai/claude-code

# 阶段1: 解析依赖(10-15秒)
npm WARN deprecated inflight@1.0.6: This module is not supported
npm WARN deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
# ↑ WARN是警告,不是错误,可以忽略

# 阶段2: 下载包(20-40秒,取决于网络)
added 1 package in 25s
# ↑ 显示下载了1个主包

# 阶段3: 安装依赖(5-10秒)
added 123 packages in 30s
# ↑ 显示总共安装了123个包(含依赖)

# 阶段4: 审计安全(2-5秒)
15 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
# ↑ 显示没有安全漏洞
```

**安装成功的标志**:
```
✓ 看到 "added XXX packages in XXXs"
✓ 没有 "ERR!" 字样
✓ 最后一行不是错误信息
```

**步骤4: 验证安装成功**

```cmd
# 验证1: 检查版本号
claude --version

# 预期输出
Claude Code v1.0.58 (npm)
# ↑ v1.0.58是版本号,可能略有不同
# ↑ (npm)表示通过npm安装

# 验证2: 检查安装位置
where claude

# 预期输出(Windows)
C:\Users\你的用户名\AppData\Roaming\npm\claude.cmd
C:\Program Files\nodejs\claude

# 验证3: 检查帮助信息
claude --help

# 应该显示完整的帮助文档
```

#### Windows常见错误及解决方案

**错误1: EACCES: permission denied**

```cmd
npm ERR! code EACCES
npm ERR! syscall mkdir
npm ERR! path C:\Program Files\nodejs\node_modules\@anthropic-ai
npm ERR! errno -4048
npm ERR! Error: EACCES: permission denied
```

**原因**: 没有管理员权限

**解决方案**:
```cmd
# 方案1: 以管理员身份重新打开CMD(推荐)
# 步骤: Win键 → 输入cmd → 右键 → 以管理员身份运行

# 方案2: 修改npm全局目录到用户目录(一劳永逸)
mkdir %USERPROFILE%\npm-global
npm config set prefix %USERPROFILE%\npm-global

# 添加到系统PATH
# Win+R → sysdm.cpl → 高级 → 环境变量
# 用户变量的Path中添加: %USERPROFILE%\npm-global

# 重启CMD后再安装
npm install -g @anthropic-ai/claude-code
```

**错误2: ETIMEDOUT network timeout**

```cmd
npm ERR! code ETIMEDOUT
npm ERR! syscall connect
npm ERR! errno ETIMEDOUT
npm ERR! network request to https://registry.npmjs.org/@anthropic-ai%2fclaude-code failed, reason: connect ETIMEDOUT 104.16.0.0:443
```

**原因**: 网络无法访问npm官方源

**解决方案**:
```cmd
# 方案1: 使用国内镜像(推荐)
npm install -g @anthropic-ai/claude-code --registry=https://registry.npmmirror.com

# 方案2: 配置代理(如果有代理工具)
set HTTP_PROXY=http://127.0.0.1:7890
set HTTPS_PROXY=http://127.0.0.1:7890
npm install -g @anthropic-ai/claude-code

# 方案3: 增加超时时间
npm install -g @anthropic-ai/claude-code --timeout=60000
```

**错误3: ENOTFOUND registry.npmjs.org**

```cmd
npm ERR! code ENOTFOUND
npm ERR! syscall getaddrinfo
npm ERR! errno ENOTFOUND
npm ERR! network getaddrinfo ENOTFOUND registry.npmjs.org
```

**原因**: DNS解析失败

**解决方案**:
```cmd
# 方案1: 使用国内镜像
npm config set registry https://registry.npmmirror.com

# 方案2: 修改DNS服务器
# 控制面板 → 网络和共享中心 → 更改适配器设置
# 右键网卡 → 属性 → IPv4 → 使用下面的DNS服务器地址
# 首选: 8.8.8.8 (Google)
# 备用: 114.114.114.114 (国内)

# 方案3: 刷新DNS缓存
ipconfig /flushdns
```

**错误4: 'node' is not recognized**

```cmd
'node' 不是内部或外部命令,也不是可运行的程序或批处理文件。
```

**原因**: Node.js未安装或PATH未配置

**解决方案**:
```cmd
# 检查Node.js是否安装
where node
# 如果没有输出,说明未安装或PATH有问题

# 解决步骤:
# 1. 确认Node.js已安装
# 2. 手动添加Node.js到PATH
# Win+R → sysdm.cpl → 高级 → 环境变量
# 系统变量的Path中添加:
# C:\Program Files\nodejs\

# 3. 重启CMD验证
node --version
npm --version
```

#### macOS系统安装步骤

**步骤1: 打开终端**

```bash
# 方法1: 使用Spotlight
按 Command(⌘) + 空格
输入 "Terminal" 或 "终端"
按回车

# 方法2: 使用Finder
应用程序 → 实用工具 → 终端

# 方法3: 使用Launchpad
F4键 → 其他 → 终端
```

**步骤2: 安装Claude Code**

```bash
npm install -g @anthropic-ai/claude-code
```

**如果遇到权限错误**:

```bash
# 错误信息示例
npm ERR! code EACCES
npm ERR! syscall mkdir
npm ERR! path /usr/local/lib/node_modules/@anthropic-ai
npm ERR! errno -13

# 方案1: 使用sudo(最简单但不推荐)
sudo npm install -g @anthropic-ai/claude-code
# 会要求输入macOS用户密码

# 方案2: 修改npm全局目录权限(推荐,一劳永逸)
# 创建用户级npm目录
mkdir ~/.npm-global

# 配置npm使用新目录
npm config set prefix '~/.npm-global'

# 添加到PATH
# 对于zsh用户(macOS Catalina及以后)
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.zshrc
source ~/.zshrc

# 对于bash用户(较老的macOS)
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bash_profile
source ~/.bash_profile

# 现在可以不用sudo安装了
npm install -g @anthropic-ai/claude-code
```

**步骤3: 验证安装**

```bash
# 检查版本
claude --version
# 输出: Claude Code v1.0.58 (npm)

# 检查安装位置
which claude
# 输出: /Users/你的用户名/.npm-global/bin/claude

# 测试运行
claude --help
```

#### macOS常见问题

**问题1: command not found: claude**

```bash
# 原因: PATH未配置正确

# 解决步骤:
# 1. 确认安装位置
npm config get prefix
# 输出: /Users/你的用户名/.npm-global

# 2. 检查PATH
echo $PATH
# 应该包含上面的路径

# 3. 如果没有,添加到shell配置
# zsh用户:
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.zshrc
source ~/.zshrc

# bash用户:
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bash_profile
source ~/.bash_profile

# 4. 重启终端或重新加载配置
```

**问题2: 使用Homebrew安装的Node.js出现权限问题**

```bash
# 如果通过Homebrew安装Node.js,可能有特殊权限设置

# 方案1: 重新安装Node.js并修复权限
brew uninstall node
brew install node

# 修复npm权限
sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}

# 方案2: 使用nvm管理Node.js版本(推荐)
# 安装nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

# 重新加载shell配置
source ~/.zshrc  # 或 source ~/.bashrc

# 安装Node.js 22
nvm install 22
nvm use 22
nvm alias default 22

# 现在安装Claude Code不需要sudo
npm install -g @anthropic-ai/claude-code
```

#### Linux系统安装步骤

**Ubuntu/Debian系列**

```bash
# 步骤1: 更新包索引
sudo apt update

# 步骤2: 确认Node.js已安装
node --version
npm --version

# 如果未安装,安装Node.js 22:
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt-get install -y nodejs

# 步骤3: 安装Claude Code
npm install -g @anthropic-ai/claude-code

# 步骤4: 验证
claude --version
```

**CentOS/RHEL/Fedora系列**

```bash
# 步骤1: 安装Node.js
curl -fsSL https://rpm.nodesource.com/setup_22.x | sudo bash -
sudo yum install -y nodejs

# 步骤2: 安装Claude Code
npm install -g @anthropic-ai/claude-code

# 步骤3: 验证
claude --version
```

**Arch Linux**

```bash
# 步骤1: 安装Node.js
sudo pacman -S nodejs npm

# 步骤2: 安装Claude Code
npm install -g @anthropic-ai/claude-code

# 步骤3: 验证
claude --version
```

**Linux权限问题处理**

```bash
# 如果遇到EACCES错误,使用非sudo方式:

# 方案1: 修改npm全局目录
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'

# 添加到PATH(bash)
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# 添加到PATH(zsh)
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.zshrc
source ~/.zshrc

# 现在安装
npm install -g @anthropic-ai/claude-code

# 方案2: 修改npm目录权限(不推荐)
sudo chown -R $USER:$USER /usr/local/lib/node_modules
sudo chown -R $USER:$USER /usr/local/bin
```

---

### 1.3 方式2: yarn/pnpm全局安装

#### 为什么选择yarn或pnpm?

**yarn的优势**:
```
1. 速度更快(并行下载)
2. 离线缓存(安装过的包可离线使用)
3. Workspaces支持(monorepo项目必备)
4. 更好的错误信息
5. 确定性安装(yarn.lock精确锁定版本)
```

**pnpm的优势**:
```
1. 磁盘空间节省(硬链接机制,同一个包只存一份)
2. 安装速度最快(比npm快2-3倍)
3. 严格的依赖管理(避免幽灵依赖)
4. 内置支持monorepo
5. 更好的安全性
```

**性能对比实测**:
| 包管理器 | 首次安装 | 缓存安装 | 磁盘占用 |
|---------|---------|---------|---------|
| npm     | 32秒    | 18秒    | 120MB   |
| yarn    | 24秒    | 12秒    | 100MB   |
| pnpm    | 19秒    | 8秒     | 60MB    |

#### 使用yarn安装

```bash
# 步骤1: 安装yarn(如果还没有)
npm install -g yarn

# 验证yarn安装
yarn --version
# 输出: 1.22.19

# 步骤2: 使用yarn安装Claude Code
yarn global add @anthropic-ai/claude-code

# 步骤3: 配置PATH(如果需要)
# yarn的全局bin目录通常在:
yarn global bin
# macOS/Linux: ~/.yarn/bin
# Windows: %LOCALAPPDATA%\Yarn\bin

# 添加到PATH
# macOS/Linux:
echo 'export PATH="$(yarn global bin):$PATH"' >> ~/.zshrc
source ~/.zshrc

# Windows:
# 通过系统设置添加到PATH

# 步骤4: 验证
claude --version
```

#### 使用pnpm安装

```bash
# 步骤1: 安装pnpm(如果还没有)
npm install -g pnpm

# 或使用官方安装脚本(推荐)
curl -fsSL https://get.pnpm.io/install.sh | sh -

# Windows用户使用PowerShell:
iwr https://get.pnpm.io/install.ps1 -useb | iex

# 验证pnpm安装
pnpm --version
# 输出: 8.12.0

# 步骤2: 使用pnpm安装Claude Code
pnpm add -g @anthropic-ai/claude-code

# 步骤3: 配置PATH(如果需要)
# pnpm的全局bin目录:
pnpm root -g
# macOS/Linux: ~/.local/share/pnpm
# Windows: %LOCALAPPDATA%\pnpm

# pnpm通常会自动配置PATH
# 如果没有,手动添加:
# macOS/Linux:
echo 'export PATH="$HOME/.local/share/pnpm:$PATH"' >> ~/.zshrc

# 步骤4: 验证
claude --version
```

#### yarn/pnpm常见问题

**问题1: yarn global add后找不到命令**

```bash
# 检查yarn的全局bin目录
yarn global bin

# 确保该目录在PATH中
echo $PATH | grep yarn

# 如果没有,添加:
export PATH="$(yarn global bin):$PATH"

# 永久添加到配置文件
echo 'export PATH="$(yarn global bin):$PATH"' >> ~/.zshrc
```

**问题2: pnpm命令找不到**

```bash
# pnpm安装后需要重启终端

# 如果仍然找不到,手动添加到PATH:
# 找到pnpm的位置
which pnpm
# 或
ls -la ~/.local/share/pnpm

# 添加到shell配置
echo 'export PATH="$HOME/.local/share/pnpm:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

---

### 1.4 方式3: npx临时运行

npx是npm 5.2+自带的工具,可以直接运行npm包而无需安装。

#### 基本用法

```bash
# 直接运行Claude Code
npx @anthropic-ai/claude-code

# 第一次运行会看到:
Need to install the following packages:
  @anthropic-ai/claude-code@1.0.58
Ok to proceed? (y)
# 输入 y 并回车

# 下载并运行Claude Code
# 后续运行会直接使用缓存的版本
```

#### npx的优缺点

**优点**:
```
✓ 不污染全局环境
✓ 总是使用最新版本
✓ 适合CI/CD管道
✓ 适合临时试用
✓ 不同项目可使用不同版本
```

**缺点**:
```
✗ 首次启动慢(需要下载)
✗ 需要网络连接
✗ 无法使用短命令(必须完整包名)
✗ 启动时有延迟
```

#### 高级用法

```bash
# 指定特定版本运行
npx @anthropic-ai/claude-code@1.0.55

# 强制使用最新版本(忽略缓存)
npx --yes @anthropic-ai/claude-code

# 在特定目录运行
npx --package @anthropic-ai/claude-code -c "claude --help"

# 使用代理
HTTP_PROXY=http://127.0.0.1:7890 npx @anthropic-ai/claude-code
```

#### 创建别名简化npx使用

```bash
# bash/zsh用户
echo 'alias claude="npx @anthropic-ai/claude-code"' >> ~/.zshrc
source ~/.zshrc

# fish用户
alias claude="npx @anthropic-ai/claude-code"
funcsave claude

# Windows PowerShell用户
# 编辑配置文件: notepad $PROFILE
# 添加:
function claude { npx @anthropic-ai/claude-code @args }
```

---

### 1.5 安装后的完整验证清单

无论使用哪种安装方式,都应该运行以下验证:

```bash
# ========================================
# Claude Code安装验证清单 v2.0
# ========================================

# 验证1: 版本信息 ✓
claude --version
# 预期输出: Claude Code v1.0.58 (npm/yarn/pnpm)
# 如果看到版本号,说明基础安装成功

# 验证2: 帮助文档 ✓
claude --help
# 预期输出: 完整的命令列表和说明
# 应该包含Usage, Options, Commands等部分

# 验证3: 可执行文件位置 ✓
# Windows:
where claude
# macOS/Linux:
which claude
# 预期输出: 显示claude命令的完整路径

# 验证4: Node.js版本兼容性 ✓
node --version
# 预期输出: v18.x, v20.x, 或 v22.x
# 如果低于v18,需要升级Node.js

# 验证5: npm配置检查 ✓
npm config list
# 检查registry是否配置正确
# 检查prefix(全局安装路径)

# 验证6: 环境变量检查 ✓
# Windows CMD:
echo %ANTHROPIC_API_KEY%
# Windows PowerShell:
echo $env:ANTHROPIC_API_KEY
# macOS/Linux:
echo $ANTHROPIC_API_KEY
# 预期输出: sk-ant-api03-开头的API Key

# 验证7: 网络连通性 ✓
# Windows:
ping api.anthropic.com
# macOS/Linux:
ping -c 3 api.anthropic.com
# 预期输出: 收到响应,延迟<500ms

# ========================================
# 如果所有验证都通过,安装成功! 🎉
# ========================================
```

**验证结果记录表**:

| 验证项 | 命令 | 通过 | 失败原因 |
|-------|------|------|---------|
| 版本信息 | `claude --version` | [ ] | |
| 帮助文档 | `claude --help` | [ ] | |
| 文件位置 | `which/where claude` | [ ] | |
| Node.js | `node --version` | [ ] | |
| npm配置 | `npm config list` | [ ] | |
| API Key | `echo $ANTHROPIC_API_KEY` | [ ] | |
| 网络 | `ping api.anthropic.com` | [ ] | |

---

## 第二部分: 首次启动配置向导(2,500字)

### 2.1 启动Claude Code的三种方式

#### 方式1: 标准交互模式(最常用)

```bash
# 在任意目录启动
claude

# 启动流程:
# 1. 检测当前目录
# 2. 加载CLAUDE.md(如果存在)
# 3. 进入交互式对话界面
```

#### 方式2: 单次命令模式

```bash
# 执行单个命令后退出
claude "你的问题或指令"

# 示例:
claude "What is 2 + 2?"
claude "List files in current directory"
claude "Explain this code: app.js"
```

#### 方式3: 打印模式(脚本友好)

```bash
# 只输出AI响应,不显示格式
claude -p "你的问题"

# 示例:
claude -p "hello" > output.txt
echo "分析这段代码" | claude -p
```

### 2.2 首次启动的初始化流程

当你第一次运行`claude`时,会经历一个交互式配置向导。

#### 欢迎界面

```
╭─────────────────────────────────────────────────────────╮
│                                                         │
│         ██████╗██╗      █████╗ ██╗   ██╗██████╗███████╗│
│        ██╔════╝██║     ██╔══██╗██║   ██║██╔══██╗██╔════╝│
│        ██║     ██║     ███████║██║   ██║██║  ██║█████╗  │
│        ██║     ██║     ██╔══██║██║   ██║██║  ██║██╔══╝  │
│        ╚██████╗███████╗██║  ██║╚██████╔╝██████╔╝███████╗│
│         ╚═════╝╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚══════╝│
│                                                         │
│                    Welcome to Claude Code!              │
│                    Version 1.0.58                       │
│                                                         │
│   AI-powered coding assistant by Anthropic              │
│                                                         │
╰─────────────────────────────────────────────────────────╯

Let's get you set up...
```

#### 配置步骤1: 选择主题

```
? Choose your theme:
  ❯ Light (浅色主题,适合白天)
    Dark (深色主题,适合夜晚)
    System (跟随系统设置,推荐)

使用 ↑/↓ 箭头键选择,按回车确认
```

**主题说明**:
```
Light主题:
- 浅色背景,深色文字
- 适合光线充足的环境
- 减少屏幕眩光

Dark主题:
- 深色背景,浅色文字
- 护眼,适合长时间编程
- 节省OLED屏幕电量

System主题:
- 自动跟随系统深色/浅色模式
- 根据时间自动切换
- 推荐选择
```

**如何修改主题**:
```bash
# 启动后可以随时修改
> /settings theme
# 或
claude config set --global theme dark
```

#### 配置步骤2: 安全须知确认

```
╭─────────────────────────────────────────────────────────╮
│                     Safety Notice                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Claude Code will operate in the current directory:    │
│  /Users/yourname/projects/my-app                        │
│                                                         │
│  This means Claude can:                                 │
│  ✓ Read files in this directory and subdirectories     │
│  ✓ Create new files                                    │
│  ✓ Modify existing files (with your confirmation)      │
│  ✓ Run commands (with your confirmation)               │
│  ✓ Access git repository information                   │
│                                                         │
│  Claude will NOT:                                       │
│  ✗ Access files outside this directory                 │
│  ✗ Access your personal data                           │
│  ✗ Execute commands without permission                 │
│  ✗ Share your code with external services              │
│                                                         │
│  Please ensure you trust this workspace.               │
│                                                         │
╰─────────────────────────────────────────────────────────╯

? Do you understand and accept these conditions?
  ❯ Yes, I understand and accept
    No, exit and reconsider
```

**重要理解**:
```
Claude Code的权限模型:
1. 沙盒隔离 - 只能访问当前目录
2. 确认机制 - 危险操作需要你确认
3. 只读优先 - 默认只读,修改需授权
4. 审计日志 - 所有操作都有记录
```

**如果选择"No"会发生什么**:
```
- Claude Code立即退出
- 不会保存任何配置
- 下次启动会再次显示此页面
- 你可以换一个你信任的目录再启动
```

#### 配置步骤3: 目录信任确认

```
? Trust this directory?
  /Users/yourname/projects/my-app

  This will allow Claude Code to:
  - Read and analyze code
  - Create and modify files (with confirmation)
  - Run commands (with confirmation)
  - Access git information

  Directory trust is workspace-specific.
  You will be asked again for different directories.

  ❯ Yes, trust this directory
    No, exit
    Trust this directory and all parent directories
```

**目录信任机制**:
```
Claude Code的目录信任类似VS Code的工作区信任:

信任级别:
1. 完全不信任 - 拒绝运行(选"No")
2. 仅信任当前目录 - 默认选择
3. 信任父目录 - 一次性信任所有项目目录

信任记录存储位置:
~/.claude/trusted-directories.json

查看已信任目录:
claude config list-trusted

移除目录信任:
claude config untrust /path/to/directory
```

**何时应该选择"No"**:
```
不要信任以下目录:
✗ 下载目录(可能有恶意代码)
✗ 临时目录(不需要持久访问)
✗ 系统目录(危险!)
✗ 不明来源的代码目录
✗ 包含敏感数据的目录
```

#### 配置步骤4: 认证方式选择

```
? How would you like to authenticate?

  ❯ API Key (recommended for API users)
    Use environment variable: ANTHROPIC_API_KEY
    Most flexible and secure

    Claude App Login (for Pro/Max subscribers)
    Login via browser
    Uses your subscription quota

    Manual Entry
    Enter API key now
    Stored in config file

  Press ↑/↓ to select, Enter to confirm
```

**认证方式详解**:

**方式1: 环境变量(最推荐)**
```bash
优点:
✓ 最安全(不存储在配置文件)
✓ 跨项目共享
✓ CI/CD友好
✓ 易于管理

设置方法(Windows):
setx ANTHROPIC_API_KEY "sk-ant-api03-你的Key"

设置方法(macOS/Linux):
echo 'export ANTHROPIC_API_KEY="sk-ant-api03-你的Key"' >> ~/.zshrc
source ~/.zshrc

验证:
echo $ANTHROPIC_API_KEY
```

**方式2: Claude App登录**
```bash
优点:
✓ 使用订阅配额
✓ 不需要管理API Key
✓ 浏览器授权安全

操作流程:
1. 选择"Claude App Login"
2. 浏览器自动打开claude.ai
3. 登录你的Pro/Max账号
4. 授权Claude Code访问
5. 返回终端,认证完成

注意事项:
- 需要有Pro($20/月)或Max($100-200/月)订阅
- 使用订阅配额,不额外计费
- Token刷新自动管理
```

**方式3: 手动输入(不推荐)**
```bash
缺点:
✗ API Key存储在配置文件(安全隐患)
✗ 容易误提交到Git
✗ 跨机器需要重新配置

仅在以下情况使用:
- 临时测试
- 单机使用
- 完全理解安全风险

如果选择此方式:
? Enter your API Key:
  sk-ant-api03-█████████████████████████

API Key将保存在:
~/.claude/config.json

⚠️ 警告:
请将~/.claude/添加到.gitignore
不要分享config.json文件
```

#### 配置步骤5: 完成初始化

```
╭─────────────────────────────────────────────────────────╮
│            Setup Complete! 🎉                           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Configuration summary:                                 │
│  ✓ Theme: System                                        │
│  ✓ Authentication: API Key (environment variable)      │
│  ✓ Trusted directory: /Users/yourname/projects/my-app  │
│  ✓ Model: claude-sonnet-4 (default)                    │
│                                                         │
│  You're all set! Let's start coding.                    │
│                                                         │
│  Quick start:                                           │
│  • Type your message to chat with Claude               │
│  • Use /help to see available commands                 │
│  • Use /exit to quit                                    │
│                                                         │
│  Documentation: https://docs.anthropic.com/claude-code │
│                                                         │
╰─────────────────────────────────────────────────────────╯

Claude Code v1.0.58
Working directory: /Users/yourname/projects/my-app
CLAUDE.md: Not found (optional)

You: █
```

### 2.3 配置文件结构解析

Claude Code的配置分为全局和项目两级:

```
配置文件层级结构:
~/.claude/                      ← 全局配置目录
├── config.json                 ← 全局配置文件
├── auth-token.json             ← 认证令牌(如果使用App登录)
├── trusted-directories.json    ← 信任的目录列表
├── cache/                      ← 缓存目录
│   ├── conversations/          ← 对话历史
│   └── models/                 ← 模型缓存
└── logs/                       ← 日志目录

项目目录/.claude/              ← 项目级配置
├── config.json                 ← 项目配置(覆盖全局)
├── commands/                   ← 自定义命令
├── skills/                     ← 自定义技能
└── hooks/                      ← 自定义钩子
```

**全局config.json示例**:
```json
{
  "version": "1.0.58",
  "theme": "system",
  "model": "claude-sonnet-4",
  "maxTokens": 4096,
  "temperature": 0.7,
  "authentication": {
    "method": "environment",
    "envVar": "ANTHROPIC_API_KEY"
  },
  "editor": {
    "defaultEditor": "code",
    "openInEditor": true
  },
  "network": {
    "timeout": 30000,
    "retries": 3
  },
  "features": {
    "autoSave": true,
    "autoCompact": false,
    "telemetry": true
  }
}
```

---

## 第三部分: IDE集成配置(2,500字)

### 3.1 VS Code完整集成方案

VS Code是最流行的编辑器,与Claude Code深度集成后可以极大提升效率。

#### 步骤1: VS Code基础配置

首先确保VS Code已安装最新版本:
```bash
# 检查VS Code版本
code --version

# 如果未安装,访问:
# https://code.visualstudio.com/
```

#### 步骤2: 配置集成终端

在VS Code设置中配置Claude Code友好的终端环境:

```json
// 打开设置: Ctrl/Cmd + ,
// 点击右上角"打开设置(JSON)"按钮

{
  // 终端配置
  "terminal.integrated.defaultProfile.windows": "Git Bash",
  "terminal.integrated.defaultProfile.osx": "zsh",
  "terminal.integrated.defaultProfile.linux": "bash",

  // 终端字体(支持特殊字符)
  "terminal.integrated.fontFamily": "Menlo, Monaco, 'Courier New', monospace",
  "terminal.integrated.fontSize": 13,

  // 终端环境变量(可选,推荐在系统级配置)
  "terminal.integrated.env.windows": {
    "ANTHROPIC_API_KEY": "sk-ant-api03-你的Key"
  },
  "terminal.integrated.env.osx": {
    "ANTHROPIC_API_KEY": "sk-ant-api03-你的Key"
  },
  "terminal.integrated.env.linux": {
    "ANTHROPIC_API_KEY": "sk-ant-api03-你的Key"
  },

  // Claude Code特定设置
  "files.associations": {
    "CLAUDE.md": "markdown"
  },

  // 自动保存(与Claude Code配合更好)
  "files.autoSave": "afterDelay",
  "files.autoSaveDelay": 1000
}
```

⚠️ **安全提示**:
- 不要在VS Code配置中硬编码API Key
- 如果必须配置,确保`settings.json`不被提交到Git
- 建议在系统环境变量中配置API Key

#### 步骤3: 创建VS Code任务

在项目根目录创建`.vscode/tasks.json`:

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Claude Code: 启动交互模式",
      "type": "shell",
      "command": "claude",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "runOptions": {
        "instanceLimit": 1
      }
    },
    {
      "label": "Claude Code: 快速提问",
      "type": "shell",
      "command": "claude \"${input:quickQuestion}\"",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true
      }
    },
    {
      "label": "Claude Code: 审查当前文件",
      "type": "shell",
      "command": "claude \"Review ${relativeFile} and suggest improvements\"",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      }
    },
    {
      "label": "Claude Code: 解释当前文件",
      "type": "shell",
      "command": "claude \"Explain what ${relativeFile} does\"",
      "problemMatcher": []
    },
    {
      "label": "Claude Code: 添加注释",
      "type": "shell",
      "command": "claude \"Add comprehensive comments to ${relativeFile}\"",
      "problemMatcher": []
    },
    {
      "label": "Claude Code: 重构代码",
      "type": "shell",
      "command": "claude \"Refactor ${relativeFile} following best practices\"",
      "problemMatcher": []
    },
    {
      "label": "Claude Code: 生成测试",
      "type": "shell",
      "command": "claude \"Generate unit tests for ${relativeFile}\"",
      "problemMatcher": []
    },
    {
      "label": "Claude Code: 修复错误",
      "type": "shell",
      "command": "claude \"Fix errors in ${relativeFile}\"",
      "problemMatcher": []
    },
    {
      "label": "Claude Code: 系统诊断",
      "type": "shell",
      "command": "claude /doctor",
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "quickQuestion",
      "type": "promptString",
      "description": "输入你的问题或指令"
    }
  ]
}
```

**使用任务**:
```
方法1: 命令面板
Ctrl/Cmd + Shift + P
输入: Tasks: Run Task
选择对应的Claude Code任务

方法2: 快捷键(下一步配置)

方法3: 终端菜单
Terminal → Run Task...
```

#### 步骤4: 配置快捷键

创建或编辑`.vscode/keybindings.json`:

```json
[
  {
    "key": "ctrl+shift+c",
    "command": "workbench.action.tasks.runTask",
    "args": "Claude Code: 启动交互模式"
  },
  {
    "key": "ctrl+shift+q",
    "command": "workbench.action.tasks.runTask",
    "args": "Claude Code: 快速提问"
  },
  {
    "key": "ctrl+shift+r",
    "command": "workbench.action.tasks.runTask",
    "args": "Claude Code: 审查当前文件"
  },
  {
    "key": "ctrl+shift+e",
    "command": "workbench.action.tasks.runTask",
    "args": "Claude Code: 解释当前文件"
  },
  {
    "key": "ctrl+shift+t",
    "command": "workbench.action.tasks.runTask",
    "args": "Claude Code: 生成测试"
  }
]
```

**快捷键说明**:
| 快捷键 | 功能 | 说明 |
|-------|------|------|
| `Ctrl+Shift+C` | 启动交互模式 | 打开Claude对话 |
| `Ctrl+Shift+Q` | 快速提问 | 弹出输入框 |
| `Ctrl+Shift+R` | 审查文件 | 代码审查 |
| `Ctrl+Shift+E` | 解释文件 | 代码解释 |
| `Ctrl+Shift+T` | 生成测试 | 自动生成测试 |

**自定义快捷键**:
```
可以根据个人习惯修改快捷键:
1. File → Preferences → Keyboard Shortcuts
2. 搜索"Tasks: Run Task"
3. 点击铅笔图标修改
4. 按下你想要的组合键
5. Enter确认
```

#### 步骤5: 创建代码片段

创建Claude Code相关的代码片段,快速插入常用注释:

`.vscode/claude.code-snippets`:
```json
{
  "Claude Code Prompt": {
    "prefix": "claude",
    "body": [
      "// @claude: ${1:instruction}",
      "$0"
    ],
    "description": "插入Claude Code提示注释"
  },
  "Claude Code Review Request": {
    "prefix": "claude-review",
    "body": [
      "// @claude: Please review this ${1:function/class/file}",
      "// Focus on:",
      "// - ${2:Performance}",
      "// - ${3:Security}",
      "// - ${4:Best practices}",
      "$0"
    ],
    "description": "请求Claude审查代码"
  },
  "Claude Code Refactor Request": {
    "prefix": "claude-refactor",
    "body": [
      "// @claude: Refactor this ${1:function/class}",
      "// Requirements:",
      "// - ${2:Improve readability}",
      "// - ${3:Optimize performance}",
      "// - ${4:Add error handling}",
      "$0"
    ],
    "description": "请求Claude重构代码"
  }
}
```

**使用代码片段**:
```
1. 在代码中输入: claude
2. 按Tab键展开
3. 填写提示内容
4. Tab跳转到下一个位置
```

#### 步骤6: 工作区配置模板

创建`.vscode/settings.json`项目级配置:

```json
{
  // Claude Code项目配置
  "claude.model": "claude-sonnet-4",
  "claude.maxTokens": 8192,
  "claude.temperature": 0.7,

  // 文件关联
  "files.associations": {
    "CLAUDE.md": "markdown",
    ".claude/config.json": "jsonc"
  },

  // 排除Claude Code缓存目录
  "files.exclude": {
    "**/.claude/cache": true,
    "**/.claude/logs": true
  },

  // 搜索排除
  "search.exclude": {
    "**/.claude/cache": true,
    "**/.claude/logs": true
  },

  // Git忽略建议
  "files.watcherExclude": {
    "**/.claude/cache/**": true,
    "**/.claude/logs/**": true
  }
}
```

### 3.2 Cursor编辑器集成

Cursor是基于VS Code的AI-First编辑器,与Claude Code天然契合。

#### Cursor独特优势

```
Cursor = VS Code + 原生AI功能
因此Cursor天然比VS Code更适合Claude Code

优势:
✓ 内置AI对话面板
✓ AI代码补全
✓ 自然语言编辑
✓ 代码解释功能
✓ 与Claude Code互补而非冲突
```

#### Cursor安装

```bash
# macOS
brew install --cask cursor

# Windows
# 访问 https://cursor.sh 下载安装包

# Linux
# 访问 https://cursor.sh 下载AppImage
```

#### Cursor + Claude Code配置

Cursor的配置与VS Code完全相同,直接复用上面的配置:

```bash
# 将VS Code配置复制到Cursor
# macOS/Linux:
cp -r ~/project/.vscode ~/project/.cursor

# Windows:
xcopy /E /I %USERPROFILE%\project\.vscode %USERPROFILE%\project\.cursor
```

#### 最佳实践工作流

```
推荐工作流: Cursor AI + Claude Code双AI协作

场景1: 快速代码补全
→ 使用Cursor的内置AI(Tab键)
→ 快速,无需切换

场景2: 复杂逻辑重构
→ 使用Claude Code(Ctrl+Shift+C)
→ 更强推理能力

场景3: 代码审查
→ 使用Claude Code
→ 更全面的上下文理解

场景4: 生成测试
→ 使用Claude Code
→ 更完整的测试覆盖
```

### 3.3 JetBrains IDEs集成(WebStorm/PyCharm/IntelliJ等)

#### 配置External Tools

**步骤1: 打开External Tools设置**

```
Windows/Linux: File → Settings → Tools → External Tools
macOS: Preferences → Tools → External Tools
```

**步骤2: 添加Claude Code工具**

点击 `+` 添加新工具,配置如下:

```
Tool 1: Claude Code交互模式
━━━━━━━━━━━━━━━━━━━━━━
Name: Claude Code
Description: Launch Claude Code interactive mode
Program: claude
Arguments: (留空)
Working directory: $ProjectFileDir$
勾选: ☑ Open console for tool output
勾选: ☑ Synchronize files after execution

Tool 2: 审查当前文件
━━━━━━━━━━━━━━━━━━━━━━
Name: Claude: Review Current File
Program: claude
Arguments: "Review $FilePath$ and suggest improvements"
Working directory: $ProjectFileDir$

Tool 3: 解释当前文件
━━━━━━━━━━━━━━━━━━━━━━
Name: Claude: Explain Current File
Program: claude
Arguments: "Explain what $FilePath$ does"
Working directory: $ProjectFileDir$

Tool 4: 生成测试
━━━━━━━━━━━━━━━━━━━━━━
Name: Claude: Generate Tests
Program: claude
Arguments: "Generate unit tests for $FilePath$"
Working directory: $ProjectFileDir$
```

**可用的宏变量**:
| 宏 | 说明 | 示例 |
|---|------|------|
| `$FilePath$` | 当前文件完整路径 | /project/src/app.js |
| `$FileRelativePath$` | 当前文件相对路径 | src/app.js |
| `$FileName$` | 当前文件名 | app.js |
| `$ProjectFileDir$` | 项目根目录 | /project |
| `$SelectedText$` | 选中的文本 | function test() |

**步骤3: 配置快捷键**

```
Windows/Linux: File → Settings → Keymap
macOS: Preferences → Keymap

在搜索框输入: External Tools
找到你添加的Claude Code工具
右键 → Add Keyboard Shortcut
设置快捷键(如Ctrl+Shift+C)
```

**推荐快捷键配置**:
| 功能 | Windows/Linux | macOS |
|-----|---------------|-------|
| 交互模式 | `Ctrl+Shift+C` | `Cmd+Shift+C` |
| 审查文件 | `Ctrl+Shift+R` | `Cmd+Shift+R` |
| 解释文件 | `Ctrl+Shift+E` | `Cmd+Shift+E` |
| 生成测试 | `Ctrl+Shift+T` | `Cmd+Shift+T` |

**步骤4: 配置终端环境变量**

```
Windows/Linux: File → Settings → Tools → Terminal
macOS: Preferences → Tools → Terminal

找到"Environment variables"选项
点击"+"添加:
ANTHROPIC_API_KEY=sk-ant-api03-你的Key
```

---

## 第四部分: Hello World验证测试(1,000字)

完成所有配置后,运行一系列测试确保Claude Code完全可用。

### 4.1 基础功能测试套件

```bash
# ========================================
# Claude Code验证测试套件 v2.0
# ========================================

echo "开始Claude Code完整验证..."

# 测试1: 版本检查 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试1/10] 版本检查..."
claude --version
# 预期: Claude Code v1.0.58 (npm)

# 测试2: 简单数学 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试2/10] 简单问答..."
claude "What is 2 + 2?"
# 预期: 4

# 测试3: 中文支持 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试3/10] 中文支持..."
claude "你好,请用一句话介绍你自己"
# 预期: 中文回复

# 测试4: 代码生成 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试4/10] 代码生成..."
claude "Create hello.py with a function that prints 'Hello, Claude Code!'"
# 预期: 生成hello.py文件

# 测试5: 文件读取 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试5/10] 文件读取..."
cat hello.py
claude "Read hello.py and explain what it does"
# 预期: 正确解释代码功能

# 测试6: 文件修改 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试6/10] 文件修改..."
claude "Add a parameter 'name' to the function in hello.py"
# 预期: 修改后的hello.py包含name参数

# 测试7: 多轮对话 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试7/10] 交互模式..."
# 手动测试:
# claude
# > What files are here?
# > Create test.txt with "Hello World"
# > Read test.txt
# > /exit

# 测试8: 命令系统 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试8/10] 命令系统..."
# claude (进入交互模式)
# > /help
# > /doctor
# > /project-info
# > /exit

# 测试9: 错误处理 ━━━━━━━━━━━━━━━━━━━━
echo "\n[测试9/10] 错误处理..."
claude "Read nonexistent-file.txt"
# 预期: 优雅地提示文件不存在

# 测试10: 系统诊断 ━━━━━━━━━━━━━━━━━━━
echo "\n[测试10/10] 系统诊断..."
claude /doctor
# 预期: 所有检查项通过

echo "\n=========================================="
echo "测试完成! 请检查所有输出是否符合预期。"
echo "=========================================="
```

### 4.2 Hello World项目实战

创建一个完整的Hello World项目,测试所有功能:

```bash
# 步骤1: 创建项目目录
mkdir ~/claude-hello-world
cd ~/claude-hello-world

# 步骤2: 初始化Git仓库
git init

# 步骤3: 让Claude创建项目结构
claude << 'EOF'
Please create a complete Hello World project with:
1. Python script: hello.py - prints "Hello, Claude Code!"
2. README.md - explains the project
3. requirements.txt - (empty for now)
4. .gitignore - Python-specific
EOF

# 步骤4: 让Claude生成测试
claude "Generate pytest tests for hello.py in test_hello.py"

# 步骤5: 运行测试
pip install pytest
pytest test_hello.py

# 步骤6: 让Claude改进代码
claude "Improve hello.py by adding command-line arguments and docstrings"

# 步骤7: 让Claude生成文档
claude "Update README.md with usage examples and installation instructions"

# 步骤8: 代码审查
claude "Review all Python files and suggest improvements"

# 步骤9: 提交到Git
git add .
git commit -m "Initial commit: Hello World project created with Claude Code"

# 步骤10: 验证完整性
ls -la
cat README.md
python hello.py
pytest test_hello.py
```

预期项目结构:
```
claude-hello-world/
├── .git/
├── .gitignore
├── hello.py
├── test_hello.py
├── README.md
├── requirements.txt
└── CLAUDE.md (可选)
```

---

## 第五部分: 常见安装配置错误排查(1,000字)

### 5.1 平台特定问题

#### Windows平台

**问题1: PowerShell执行策略限制**

```powershell
# 错误信息
claude : 无法加载文件 C:\Users\...\npm\claude.ps1,因为在此系统上禁止运行脚本。

# 解决方案
# 方法1: 修改执行策略(管理员PowerShell)
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# 方法2: 使用CMD而不是PowerShell
# Win+R → cmd

# 方法3: 每次允许执行
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

**问题2: 路径包含空格或中文**

```cmd
# 错误示例
npm ERR! path C:\Program Files\nodejs\中文目录\claude

# 解决方案
# 1. 不要在中文路径下安装Node.js
# 2. 修改npm全局目录到无空格路径:
npm config set prefix C:\npm-global
# 添加C:\npm-global到系统PATH
```

**问题3: Windows Defender误报**

```
# 症状: 安装过程中文件被删除
# 原因: Windows Defender将node.exe识别为潜在威胁

# 解决方案
# 1. 添加npm目录到排除列表
#    Windows安全 → 病毒和威胁防护 → 排除项
#    添加: C:\Users\<用户名>\AppData\Roaming\npm

# 2. 临时禁用实时保护(不推荐)
```

#### macOS平台

**问题1: 命令找不到但已安装**

```bash
# 症状
claude: command not found
# 但 npm list -g 显示已安装

# 原因: PATH未更新

# 解决方案
# 检查npm全局bin路径
npm config get prefix
# 通常是 /usr/local 或 ~/.npm-global

# 添加到PATH
echo 'export PATH="/usr/local/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# 或重启终端
```

**问题2: macOS Gatekeeper阻止**

```bash
# 症状
"claude" cannot be opened because the developer cannot be verified

# 解决方案
# 方法1: 允许此应用(不推荐)
sudo xattr -r -d com.apple.quarantine /usr/local/bin/claude

# 方法2: 在安全偏好设置中允许
# 系统偏好设置 → 安全性与隐私 → 通用 → 点击"仍要打开"

# 方法3: 通过npm安装通常不会触发此问题
```

**问题3: 权限问题(使用sudo安装后)**

```bash
# 症状
claude: permission denied

# 原因: 使用sudo安装,文件属于root

# 解决方案
# 修复npm全局目录权限
sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}

# 或重新安装(不使用sudo)
npm uninstall -g @anthropic-ai/claude-code
npm install -g @anthropic-ai/claude-code
```

#### Linux平台

**问题1: npm全局目录权限**

```bash
# 错误
EACCES: permission denied

# 解决方案(最佳实践)
# 配置用户级全局目录
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# 重新安装
npm install -g @anthropic-ai/claude-code
```

**问题2: 缺少编译工具**

```bash
# 症状
gyp ERR! build error
gyp ERR! stack Error: not found: make

# 原因: 某些npm包需要编译,缺少build-essential

# 解决方案
# Ubuntu/Debian:
sudo apt-get install build-essential

# CentOS/RHEL:
sudo yum groupinstall "Development Tools"

# Fedora:
sudo dnf groupinstall "Development Tools"
```

### 5.2 网络相关问题

**问题: npm install超时**

```bash
# 症状
npm ERR! network timeout

# 解决方案1: 使用国内镜像
npm config set registry https://registry.npmmirror.com

# 解决方案2: 增加超时时间
npm config set fetch-timeout 60000
npm config set fetch-retries 5

# 解决方案3: 使用代理
npm config set proxy http://127.0.0.1:7890
npm config set https-proxy http://127.0.0.1:7890

# 解决方案4: 使用VPN
# (确保VPN允许npm流量通过)
```

### 5.3 认证相关问题

**问题: API Key未生效**

```bash
# 症状
Error: Missing API Key

# 诊断步骤
# 1. 检查环境变量
echo $ANTHROPIC_API_KEY  # macOS/Linux
echo %ANTHROPIC_API_KEY%  # Windows CMD
echo $env:ANTHROPIC_API_KEY  # Windows PowerShell

# 2. 检查是否重启终端
# 环境变量修改后需要重启终端

# 3. 检查配置文件
cat ~/.claude/config.json | grep -i auth

# 4. 手动设置(临时测试)
export ANTHROPIC_API_KEY="sk-ant-api03-你的Key"
claude "test"
```

**问题: API Key格式错误**

```bash
# 症状
Error: Invalid API Key format

# 检查格式
# 正确格式: sk-ant-api03-XXXXXXXXXXXXXXXXXXXXXXXXXX
# 长度约100个字符
# 只包含字母、数字、连字符

# 常见错误
❌ sk-ant-XXXXX (缺少api03)
❌ sk-XXXXX (缺少ant-api03)
❌ 有空格或换行符
❌ 复制时多复制/少复制字符
```

---

## 课后总结

### ✅ 本课核心要点

1. **安装方式选择**
   - npm全局安装: 最常用,适合大多数场景
   - yarn/pnpm: 性能更优,适合专业开发
   - npx: 临时使用,CI/CD友好

2. **首次配置要点**
   - 主题选择: System(跟随系统)
   - 认证方式: 环境变量(最安全)
   - 目录信任: 只信任可信目录
   - 配置文件: 全局 vs 项目

3. **IDE集成**
   - VS Code: 任务+快捷键
   - Cursor: 天然契合
   - JetBrains: External Tools

4. **验证测试**
   - 完整测试套件
   - Hello World项目
   - 故障排查能力

### 📚 下一步学习

**立即可以开始**:
- 模块2.1: CLI命令完全指南
- 模块2.2: 交互模式与工作流

**中级进阶**:
- 模块3: Commands系统(自定义命令)
- 模块4: MCP集成(扩展能力)

**高级主题**:
- 模块5: Hooks系统
- 模块6: Skills定制

### 💡 学习建议

1. **每日实践**
   - 每天用Claude Code编程至少30分钟
   - 尝试用不同命令完成同一任务
   - 记录遇到的问题和解决方案

2. **建立习惯**
   - 代码前先问Claude
   - 重构前先审查
   - 提交前生成测试

3. **分享交流**
   - 加入Claude社区
   - 分享使用技巧
   - 帮助其他新手

---

**课程版本**: V2.0
**最后更新**: 2025-12-11
**字数统计**: ~10,000字
**作者**: Claude Code课程团队

🎉 **恭喜完成安装配置实战！现在开始你的AI编程之旅吧！**
